package gui.blink;

import global.DigitToHandle;
import global.ExceptionFormatter;

class HourBlink
extends Blink
{
	// Aktiver Thread zum Blinken
	private Thread thread;
	
	
	/**
	 * <code>enter</code> wird aufgerufen, wenn der Zustand geändert werden soll.
	 * Diese Methode ist Teil des State-Pattern, d.h. hier werden Aktionen ausgeführt,
	 * wenn dieser Zustand betreten wird.
	 * 
	 * In dieser Klasse <code>BlinkHour</code> wird der Thread gestartet,
	 * welcher die Stunden blinken läßt.
	 *
	 */
	void enter()
	{		
		logger.info("Blink-Zustand 'BlinkHour' betreten");
		logger.info("Neuer Thread für Stunden-Blinken erzeugen und starten");
		
		this.thread = new Thread(this);
		this.thread.start();
	}
	
	
	void exit()
	{		
		logger.info("Thread stoppen");
		
		// Ist zwar unschön, aber Thread-Safe-Problem spielt hier keine Rolle.
		// Blinken ist eine ungefährliche und nebensächliche Funktionalität.
		this.thread.stop();
	}
	
	/**
	 * <code>processEvent</code> ändert den Zustand. Je nach Event-Ereignis wird
	 * der entsprechende Zustand betreten.
	 * 
	 * Der nächste Zustand ist "Minuten blinken".
	 */
	@Override
	public Blink processEvent(DigitToHandle event)
	{		
		switch(event)
		{
			case MINUTE:
					this.exit();
					blinkMinute.enter();
					return (Blink) blinkMinute;
					
			default: 
				
				logger.severe("Illegalen Zustand betreten");
				String msg = "Unbekannter Event" + event;
				throw new IllegalArgumentException(msg);
		}
	}
	
	
	/**
	 * TODO Javadoc aktualisieren
	 * Diese Methode läßt das Stunden-Digit blinken.
	 */
	public void run()
	{
		while(true)
		{
			try
			{
				Thread.sleep(this.intervall);
				lhour.setVisible(false);
				Thread.sleep(this.intervall);
				lhour.setVisible(true);				
			}
			catch(InterruptedException e)
			{
				logger.warning(ExceptionFormatter.format(e));
			}
		}
	}
}